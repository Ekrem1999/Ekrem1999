Настройка Clojure в OS X
Я потратил много времени, пытаясь найти довольно оптимальную (для меня) установку для Clojure... в то же время я пытался погрузиться и изучить ее. Это никогда не бывает оптимальным; вы не должны бороться с окружающей средой, пытаясь чему-то научиться.

Я чувствую, что прошел через много боли, ища Google, StackOverflow, блоги и другие сайты для случайных лакомых кусочков информации и инструкций.

Это всеобъемлющее "то, что я узнал, и то, что я в конечном итоге сделал", которое, как мы надеемся, будет полезно для других и действовать как журнал для себя, если мне когда-либо придется делать это снова. Я хочу быть очень пошаговым и объяснить, что происходит (и почему) на каждом шагу.

Шаг 1: Получение Clojure (1.3)
Я уже был знаком с (и имел) Homebrew ( http://mxcl.github.com/homebrew/ ). если у вас еще не установлен Homebrew, я настоятельно рекомендую его получить. Я не буду скрывать, что слышу, поскольку это не так сложно, но я также не хочу нести ответственность за то, что вы случайно сдули свой /usr/localпуть… ;-)

Но, предполагая, что у Вас установлен Homebrew, давайте установим последнюю версию Clojure:

$ brew install clojure
Шаг 2: (Mis-) Понимание Clojure.Contrib
Начиная изучать Clojure, многие люди похожи на меня и хотят немедленно погрузиться в личный проект. Для себя, у меня есть несколько общих приложений, которые я хотел бы сделать с любым новым языком, чтобы получить представление о том, как это работает. Я выбрал простой сервер чата на основе telnet.

Я выполнил быстрый поиск Google для "сокетов clojure" и "потоков clojure" и сразу же был представлен с несколькими страницами, где различные библиотеки (в clojure.contrib) может помочь мне выйти. Затем я провел следующие несколько часов, пытаясь понять, как заставить их работать.

Проблема заключается в том, что - с Clojure 1.3-библиотека "contrib" была удалена в пользу разбиения библиотек и либо размещения их в своей собственной библиотеке, либо встраивания их в ядро Clojure. Это хорошая страница для использования в качестве ссылки на то, что произошло с различными библиотеками contrib, с которыми вы можете столкнуться в интернете:

http://dev.clojure.org/display/design/Where+Did+Clojure. Contrib + Go

Просто знайте, что если Вы читаете учебник по Clojure, который использует clojure-contribбиблиотеку, он устарел, и вам, возможно, потребуется посмотреть на приведенную выше ссылку, чтобы увидеть, что произошло с рассматриваемой библиотекой.

Шаг 3: проекты Leiningen и Clojure
Следующим шагом было изучение того, как настроить проект Clojure. Почти все учебники Clojure и примеры, с которыми я столкнулся, упоминали бы project.cljфайл, но затем не дают никаких подробностей. Я потратил кучу времени, изучая CLASSPATH JVM (примечание: Я новичок в JVM) и пытаясь "заставить его работать" безуспешно. Как оказалось, есть замечательный инструмент, созданный Филом Хагельбергом, который помогает в этом под названием Leiningen ( https://github.com/technomancy/leiningen ).

Установка Leiningen
Homebrew снова приходит на помощь и может установить его для вас:

$ brew install leiningen
После установки Leiningen решает многие важные проблемы для вас, в основном связанные с CLASSPATH Java, настройкой проекта, зависимостями и построением.

Ваш Первый Проект
После установки Leiningen, вы можете использовать его для создания нового проекта Clojure, с которым вы можете начать играть.

$ lein new myproj
Это создаст новую папку myproj/из текущего каталога, а также простой Скелтон (включая .gitignoreфайл, насколько полезно):

+
| project.clj
| README
+ src/
| + myproj/
| | | core.clj
+ test/
| + myproj/
| | + test
| | | core.clj
Теперь, если вы быстро взглянете на project.cljнас, мы можем увидеть базовую настройку для нашего первого проекта:

(defproject  myproj  "1.0.0-SNAPSHOT"
  : description  "FIXME: write description"
  : dependencies [[org.clojure/clojure "1.3.0"]])
На данный момент наиболее важной частью данного файла является :dependenciesраздел. Это список того, что myprojтребуется для загрузки, компиляции и запуска.

Если вы помните подсказку из более ранних версий, JVM имеет переменную среды CLASSPATH, которая используется для поиска необходимых библиотек. То, что Leiningen делает для вас, это взять свой список зависимостей и установить их в известном месте для вашего проекта. Это делается с помощью depsкоманды:

$ lein deps
Copying 1 file to ./myproj/lib
Если вы посмотрите, что теперь есть lib/папка в вашем каталоге проекта, и она содержит одну зависимость jar для Clojure, которая была указана в вашем project.cljфайле.

На данный момент у нас есть все, что нам нужно, чтобы начать играть вокруг и делать интересные вещи происходят. Мы можем использовать Leiningen, чтобы начать Clojure теперь из нашей папки проекта и иметь доступ ко всем нашим зависимостям и исходным файлам проекта.

$ lein repl
REPL started; server listening on localhost port 17970
user=> 
Пока мы собираемся перейти к следующему шагу, но мы вернемся в Лейнинген позже…

Шаг 4: Среда Разработки
Именно здесь - как и с любым языком программирования-сообщество расходится невероятно на целый ряд рекомендаций. И, как и с любым языком, который удаленно основан на Lisp, Emacs + Slime будет рекомендацией № 1.

Я использовал Emacs в течение многих лет для общего развития Lisp со слизью, и мне это нравится. И я также использовал Vim для большого количества редактирования, и у него также есть много замечательных функций. Я говорю это, потому что моя рекомендация не будет использовать ни то, ни другое, и я хотел, чтобы вы знали, что я использую их и люблю их. Так что моя рекомендация использовать что - то еще основана на том, что я приложил серьезные усилия, чтобы получить любую работу, с треском провалился, и не считаю, что кто - то должен пройти через такой ад (это-и откровенно говоря-Emacs/Vim не для всех).

Отклонение Emacs + слизь и Vim + VimClosure
Если вы заинтересованы в том, чтобы вспахать свой собственный путь в этот момент и сделать Emacs работать для вас со слизью, или VimClosure с Vim, вот несколько ссылок / подсказок, которые помогут вам начать работу:

Emacs + Слизь
Во-первых, вы можете скачать режим Clojure для emacs здесь:

https://github.com/jochu/clojure-mode

Теперь, шикарный сервер для Clojure стар . Это означает, что вам придется получить старую версию Slime для работы.

Это можно сделать многими способами, и если вы знаете Emacs, то это не должно быть серьезной проблемой для вас. Проще говоря, поместите текущую версию Slime .emacs.d/slime-currentи старую версию для Clojure.emacs.d/slime-clojure, а затем сделайте две функции, на основе которых вы хотите использовать:

;; загрузить слизь для общего шепелявости
(defun  slime-common-lisp ()
 (интерактивный)
 (add-to-list 'load-path"~/.emacs.д/шлам-ток ")
 (требуется ' слизь)
 (slime-setup '(slime-fancy))
 (слизь))

;; шлам нагрузки для clojure
(defun  slime-clojure ()
 (интерактивный)
 (add-to-list 'load-path"~/.emacs.d / slime-clojure ")
 (требуется ' слизь)
 (slime-setup '())
 (slime-подключение "localhost"  4005))
Примечание: Я не могу претендовать на кредит за это... Это было собрано после очень поздней ночи прочесывания интернета и натыкаться на несколько сообщений на StackOverflow, которые приводят меня к этому решению. Я хотел бы, чтобы у меня были ссылки на публикацию, но я уже давно закрыл страницы. Если они у вас есть, отправьте их мне, и я обновлю этот пост.

Затем вам нужно будет обновить project.cljфайл и добавить новую зависимость (как плагин) для Swank. Это достаточно легко сделать, просто добавьте в файл следующую строку:

: Плагины [[lein-swank " 1.4.4 "]]
Once this has been done, you can then use Leiningen (yep!) to start up a Swank server for you:

$ lein swank
Connection opened on localhost port 4005.
Теперь вы должны быть в состоянии запустить Emacs M-x clojure-mode,и подключиться к серверу Swank С.M-x slime-clojure
Vim + VimClojure
Я не собираюсь проводить здесь много времени. Извиняюсь. Я достаточно хорошо знаю Vim, чтобы использовать его и сделать несколько сценариев Vim, но недостаточно хорошо, чтобы следовать многим страницам, которые я нашел, обсуждая экраны, патоген и т. д.

Излишне говорить, что я пытался, но в 2 часа ночи мой мозг не работал достаточно хорошо, чтобы понять все, что я читал. Вместо этого, вот несколько ссылок, которые могут помочь вам, если это путь, который вы хотите пройти…

http://www.vim.org/scripts/script.php?script_id=2501
http://blog.darevay.com/2010/10/how-i-tamed-vimclojure/
http://naleid.com/blog/2011/12/19/getting-a-clojure-repl-in-vim-with-vimclojure-nailgun-and-leiningen/
Примечание: ссылки, сделанные на установку nailgunвы можете игнорировать и просто использовать Homebrew: brew install nailgun.

Лучшее Решение: Sublime Text 2
Прежде чем вы прочтете этот раздел, вы должны заранее знать, что это не "свободный" путь: Sublime Text 2 ( http://www.sublimetext.com/2 ) является удивительным, но это также коммерческий продукт ($59 США). Есть бесплатная пробная версия, так что вперед и дать ему вихрь; я совершенно уверен, что вы будете любить его так же, как и я.

Получение возвышенного REPL…
После того, как вы установили Sublime, следующим шагом является получение Clojure REPL собирается внутри него (так же, как в Emacs, но только не совсем так мощно). Для этого нам нужно установить замечательный плагин для Sublime под названием SublimeREPL ( https://github.com/wuub/SublimeREPL ).

$ cd "$HOME/Library/Application Support/Sublime Text 2/Packages/"
$ git clone git://github.com/wuub/SublimeREP
Вот и все, что нужно сделать! После установки, если вы хотите запустить Sublime, вы можете перейти к Tools -> SublimeREPL -> Clojure -> …нему и запустить его (также обратите внимание на поддержку REPLs на многих других языках).

Сублимпл Поддерживает Лейнинген!
Что самое лучшее в SublimeREPL является то, что - из коробки-он уже имеет поддержку для Лейнингена. Все, что вам нужно сделать, это открыть свой project.cljфайл в Sublime и (с активной вкладкой этого файла) запустить Clojure REPL (а не версию telnet REPL) .

После запуска, теперь вы можете запускать код из Sublime REPL, вы будете иметь доступ ко всем вашим библиотекам зависимостей, а также иметь возможность загружать свои собственные файлы проекта, а также.

user=> (>use 'myproj.ядро: перезагрузка-все)
нуль
Подсказка: используйте ctrl+pи ctrl+nдля циклического просмотра истории REPL.

Шаг 5: Использование Локальных Библиотек
Leiningen использует программу Java под названием Maven, чтобы добраться до библиотек. Я даже не близок к новичку в использовании / понимании Maven, но вы обычно должны знать об этом и о том, откуда копируются ваши банки (через lein deps).

Понимание репозиториев Maven (basic)
В вашем домашнем каталоге находится .m2/папка. Внутри этого находится repositoryпапка. В этот момент, если lsвы будете видеть много каталогов.

Одна из них, в частности, должна выделяться-это orgпапка, внутри которой находится clojureпапка, внутри которой находится другая clojureпапка и, наконец, внутри нее находится список одной или нескольких папок версий. И, если вы посмотрите в 1.3.0справочнике, вы увидите банку для clojure-1.3.0.

Теперь, если вы вернетесь к своему project.cljфайлу, в разделе зависимости, вы помните это?

:dependencies [[org.clojure/clojure "1.3.0"]]
Итак, теперь вы можете видеть, как это описание зависимости превратилось в файл jar, который был скопирован в lib/папку вашего проекта:

[org.clojure/clojure "1.3.0"] -> 
	~/.m2/repository/org/clojure/clojure/1.3.0/clojure-1.3.0.jar
Установка Библиотек
Теперь, скажем, вы найдете хорошую библиотеку Clojure где-нибудь в GitHub, которую вы хотели бы использовать. Как вы устанавливаете его и используете в своих собственных проектах? Опять же, Лейнинген здесь, чтобы помочь нам. Существует замечательный плагин для Leiningen под названием " lein-localrepo":

https://github.com/kumarshantanu/lein-localrepo

Проверите вне README.md файл, чтобы увидеть, как установить его для различных версий Leiningen. Я собираюсь предположить, что вы используете версию < 2.0 для остальной части этого урока (используйтеlein version, чтобы увидеть, какую версию вы установили).

$ lein plugin install lein-localrepo "0.3"
После установки вы можете использовать Leiningen и плагин localrepo для добавления библиотек Clojure, которые другие написали в ваши репозитории Maven, и ссылаться на них в вашем project.cljфайле!

образец
Отель Phil Hagelberg (создатель города Лейнинген) находится в красивом порту Кло-юре.библиотека сокетов сервера contrib для Clojure 1.3, которую мы будем загружать, компилировать, устанавливать и загружать в наш проект.

Загрузка
Во-первых, давайте скачать и это:

$ git clone git://github.com/technomancy/server-socket
Скомпилируйте банку
Далее, нам нужно его скомпилировать. Это использует Leiningen, так как Server-socket является проектом на основе Leiningen. Если бы это было не так, вы бы использовали другой метод, чтобы построить банку.

$ lein jar
Created ./server-socket-1.0.0.jar
Установка баночки
Теперь давайте решим, где мы собираемся установить его. Мы можем установить его где-либо, но иногда у Лейнингена есть предложение. Давайте спросим, где Leiningen и плагин localrepo думает, что он должен идти:

$ lein localrepo coords server-socket-1.0.0.jar
server-socket-1.0.0.jar server-socket/server-socket 1.0.0
Выходные данные говорят , что - в ~/.m2/repositoryпапке-он думает, что он должен пойти server-socket/server-socketс версией "1.0.0". Итак, давайте следовать этому предложению:

$ lein localrepo install server-socket-1.0.0.jar server-socket/server-socket 1.0.0
Давайте проверим, что он пошел туда, куда мы его ожидаем:

$ ls ~/.m2/repository/server-socket/server-socket/1.0.0
server-socket-1.0.0.jar
Да! Он был успешно установлен и готов к использованию.

Важно отметить, что нам не пришлось устанавливать его в рекомендованное место. Мы могли бы установить его где-нибудь еще. Например, мы могли бы выбрать local.repo/server-socketвместо этого. Это полностью зависит от нас.

Обновление файла проекта
Для того, чтобы иметь Leiningen установить библиотеку для нашего проекта, чтобы использовать, он должен будет знать о нем. Итак, на этом этапе нам нужно будет обновить :dependenciesраздел нашего project.cljфайла:

:dependencies [[org.clojure/clojure "1.3.0"]
               [server-socket/server-socket "1.0.0"]]
И, после сохранения, мы можем перейти в каталог проекта и обновить наши установленные зависимости для проекта:

$ lein deps
Copying 2 files to /Users/jeff/Projects/myproj/lib
Заряжайте Его!
Наконец, давайте вернемся в Sublime, к нашему project.cljфайлу, и перезапустим Sublime REPL для Clojure. Как только он заработает, давайте посмотрим, сможем ли мы его использовать…

user=> (>use ' server.разъем)
нуль
Да!

Примечание: мы знали, что это былоserver.socket, а не server-socketпотому, что в репозитории GitHub для server-socket класс был расположен src/server/socket.cljи socket.cljимел пространство server.socketимен .

Вывод
Будучи новичком в Clojure, вышеизложенное заняло у меня довольно много времени, чтобы понять (пару поздних ночей), и я уверен, что все еще довольно много я пропускаю или не полностью Грок (особенно в отношении Maven). Все учебники и руководства, с которыми я столкнулся, казалось, предполагали понимание Java и/или других аспектов того, что происходило. Вот надеясь, что это руководство может помочь другим, так что им не придется тратить вечность только на то, чтобы получить простой проект Clojure и дать этому языку (и Lisp) шанс, которого он заслуживает.
